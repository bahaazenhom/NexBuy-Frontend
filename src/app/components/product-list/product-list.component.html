<div class="product-list-container">
  <div class="header-section">
    <h1>Our Products</h1>
    <p>Browse our collection of amazing products</p>
  </div>

  @if (loading) {
    <div class="loading">
      <div class="spinner"></div>
      <p>Loading products...</p>
    </div>
  }

  @if (error) {
    <div class="error-message">{{ error }}</div>
  }

  @if (!loading && !error) {
    <div class="products-grid">
      @for (product of products; track product._id) {
        <div class="product-card" [class.in-cart]="getProductQuantityInCart(product._id) > 0">
          <div class="product-image" (click)="viewProduct(product._id)">
            @if (product.images && product.images.length > 0) {
              <img [src]="product.images[0].url" [alt]="product.title" />
            } @else {
              <div class="no-image">No Image</div>
            }
            
            @if (getProductQuantityInCart(product._id) > 0) {
              <div class="in-cart-badge">
                <span>✓ In Cart</span>
              </div>
            }
          </div>
          
          <div class="product-info">
            <h3 (click)="viewProduct(product._id)">{{ product.title }}</h3>
            <p class="product-description">{{ product.desc }}</p>
            
            @if (product.specs && Object.keys(product.specs).length > 0) {
              <div class="product-specs">
                @for (key of Object.keys(product.specs).slice(0, 2); track key) {
                  <span class="spec-badge">{{ key }}: {{ product.specs[key] }}</span>
                }
              </div>
            }
            
            <div class="product-footer">
              <div class="price">${{ product.price.toFixed(2) }}</div>
              
              @if (getProductQuantityInCart(product._id) > 0) {
                <div class="quantity-controls">
                  <button 
                    class="btn btn-quantity" 
                    (click)="decreaseQuantity(product._id, $event)"
                  >
                    −
                  </button>
                  <span class="quantity-display">{{ getProductQuantityInCart(product._id) }}</span>
                  <button 
                    class="btn btn-quantity" 
                    (click)="increaseQuantity(product._id, $event)"
                  >
                    +
                  </button>
                </div>
              } @else {
                <button 
                  class="btn btn-add-cart" 
                  (click)="addToCart(product._id)"
                  [disabled]="!isLoggedIn()"
                >
                  {{ isLoggedIn() ? 'Add to Cart' : 'Login to Buy' }}
                </button>
              }
            </div>
          </div>
        </div>
      }
    </div>

    @if (products.length === 0) {
      <div class="empty-state">
        <p>No products available at the moment.</p>
      </div>
    }
  }
</div>
